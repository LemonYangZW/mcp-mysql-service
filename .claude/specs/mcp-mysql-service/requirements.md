# MCP MySQL服务功能需求分析文档（务实版本）

## 1. 项目概述

### 1.1 项目背景
为ClaudeCode环境开发一个**最小可用版本**的MCP（Model Context Protocol）服务，专注于MySQL数据库的基础查询功能。采用渐进式开发策略，优先确保代码可编译运行，再逐步增加功能。

### 1.2 核心目标（V1.0最小可用版本）
- **基础连接**：能够连接MySQL数据库
- **表结构查询**：获取基本的表和字段信息  
- **安全查询**：执行只读的SELECT查询
- **MCP集成**：与ClaudeCode环境基础集成

### 1.3 设计原则
- **可运行优先**：确保代码能编译和启动
- **功能简化**：专注核心需求，暂时移除复杂功能
- **安全第一**：即使功能简化，安全机制不能妥协
- **渐进迭代**：后续版本逐步增加高级功能

## 2. 核心功能（V1.0最小可用版本）

### 2.1 基础数据库连接
**功能描述**：简单可靠的MySQL连接

**基础需求**：
- **基础连接**：能够连接到指定的MySQL数据库
- **连接验证**：验证连接是否成功
- **基础错误处理**：连接失败时提供错误信息

**输入参数**：
```json
{
  "host": "localhost",
  "port": 3306,
  "database": "ruoyi-vue-pro", 
  "username": "root",
  "password": "password"
}
```

**输出格式**：
```json
{
  "success": true,
  "message": "数据库连接成功",
  "connection_id": "abc123"
}
```

### 2.2 表结构查询（基础版）
**功能描述**：获取数据库表的基本结构信息

**基础需求**：
- **表列表**：获取数据库中所有表的名称
- **表字段**：获取指定表的字段信息（名称、类型、是否可空）
- **基础过滤**：排除系统表

**输出格式**：
```json
{
  "success": true,
  "data": {
    "table_name": "sys_user",
    "columns": [
      {
        "name": "id",
        "type": "bigint",
        "nullable": false,
        "comment": "用户ID"
      }
    ]
  }
}
```

### 2.3 安全查询执行（基础版）
**功能描述**：执行安全的只读查询

**安全限制**：
- **只读操作**：仅允许SELECT查询
- **基础验证**：检查SQL中是否包含危险关键词
- **结果限制**：限制返回行数（默认100行）

**输入参数**：
```json
{
  "query": "SELECT id, username FROM sys_user LIMIT 10",
  "limit": 10
}
```

### 2.4 基础MCP工具集
**工具列表**：
1. `mysql_connect` - 数据库连接
2. `mysql_list_tables` - 获取表列表  
3. `mysql_describe_table` - 获取表结构
4. `mysql_query` - 执行安全查询

## 3. 暂时移除的高级功能（后续版本）

以下功能在V1.0版本中暂时移除，确保核心功能可用：
- ~~SQL执行计划分析~~
- ~~智能缓存系统~~  
- ~~性能监控和分析~~
- ~~数据质量检查~~
- ~~增量数据监控~~
- ~~复杂的统计分析~~

## 4. 技术要求（简化版）

### 4.1 开发环境
- **Node.js**: >= 18.0.0
- **TypeScript**: >= 5.0.0（基础类型定义，允许合理使用any）
- **数据库**: MySQL 8.0

### 4.2 依赖包（最小集合）
```json
{
  "dependencies": {
    "@modelcontextprotocol/sdk": "latest",
    "mysql2": "^3.6.0",
    "winston": "^3.8.0"
  },
  "devDependencies": {
    "typescript": "^5.0.0",
    "@types/node": "^18.0.0",
    "jest": "^29.0.0"
  }
}
```

### 4.3 TypeScript配置（宽松版）
```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "strict": false,
    "noImplicitAny": false,
    "esModuleInterop": true
  }
}
```

## 5. 测试要求（最小可用）

### 5.1 基础测试
- **连接测试**：验证数据库连接是否成功
- **查询测试**：验证基础查询功能
- **安全测试**：验证危险查询被拦截
- **测试覆盖率目标**：≥60%（先求有，再求好）

### 5.2 测试工具
- **Jest**：单元测试框架
- **基础Mock**：模拟数据库连接

## 6. 部署要求（简化版）

### 6.1 基础Docker配置
```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build
CMD ["node", "dist/index.js"]
```

### 6.2 基础环境变量
```env
DB_HOST=localhost
DB_PORT=3306
DB_NAME=ruoyi-vue-pro
DB_USER=root
DB_PASSWORD=password
```

## 7. 验收标准（最小可用版本）

### 7.1 功能验收
- [ ] 成功连接MySQL数据库
- [ ] 获取表列表功能正常
- [ ] 获取表结构功能正常  
- [ ] 安全查询功能正常
- [ ] 基础MCP工具可调用

### 7.2 技术验收
- [ ] TypeScript代码能够编译通过
- [ ] Jest测试能够运行（即使有些测试失败）
- [ ] 项目能够启动不报错
- [ ] 基础Docker镜像能够构建

### 7.3 安全验收
- [ ] 禁止执行INSERT/UPDATE/DELETE操作
- [ ] 查询结果行数限制生效
- [ ] 基础错误处理不暴露敏感信息

## 8. 项目里程碑（重新规划）

### 第一阶段：让代码跑起来（第1-3天）
- 基础项目结构和依赖配置
- 数据库连接功能实现
- 基础MCP服务器框架

### 第二阶段：核心功能实现（第4-6天）  
- 表结构查询功能
- 安全查询执行功能
- 基础测试编写

### 第三阶段：MCP集成（第7-8天）
- MCP工具注册和调用
- ClaudeCode环境集成测试
- 基础文档编写

### 第四阶段：稳定化（第9-10天）
- Bug修复和稳定性改进
- 测试覆盖率提升
- 基础部署配置

## 9. 风险控制

### 9.1 技术风险降低
- **降低复杂度**：移除高级功能，专注基础功能
- **宽松配置**：TypeScript配置相对宽松，减少类型错误
- **成熟依赖**：使用成熟稳定的依赖包
- **渐进开发**：小步快跑，持续验证

### 9.2 质量保证简化
- **基础测试**：确保核心功能可用
- **手动验证**：人工验证关键流程
- **错误处理**：基础的错误捕获和日志记录

---

*本需求文档采用务实的渐进式策略，优先确保代码可运行，为后续功能扩展奠定基础。*